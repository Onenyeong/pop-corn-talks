<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <title>팝콘톡</title>

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"
          integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g="
          crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: transparent;
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 999;
      height: 60px; /* 헤더 높이 감소 */
    }

    header h1 {
      margin: 0;
    }

    #welcome-message {
      color: #ffcc00;
    }

    .left-container {
      margin-top: 10px; /* 상단 여백 조정 */
      padding: 10px;
      background-color: #f0f0f0;
      border-radius: 10px;
      max-height: calc(100vh - 100px);
      overflow-y: auto;
    }

    .center-container {
      padding: 10px;
      background-color: #f0f0f0;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 80px; /* 상단 여백 증가 */
    }

    .post-card {
      width: 300px; /* 가로 너비 조정 */
      margin: 10px;
      padding: 10px;
      background-color: #fff;
      border-radius: 15px; /* 테두리 반경 조정 */
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .post-card img {
      width: 100%;
      border-radius: 15px 15px 0 0; /* 테두리 반경 조정 */
    }

    .post-card h3,
    .post-card p {
      margin: 5px 0;
      padding: 0 10px;
    }

    .right-container {
      margin-top: 10px; /* 상단 여백 조정 */
      padding: 10px;
      background-color: transparent;
      border-radius: 10px;
      display: flex;
      align-items: center;
    }

    .action-buttons {
      display: flex;
      align-items: center;
    }

    .action-buttons input[type="text"] {
      padding: 10px;
      border-radius: 20px;
      border: none;
      margin-right: 10px;
      width: 200px; /* 검색 버튼 너비 조정 */
    }

    .action-buttons button {
      padding: 10px 20px;
      color: #fff;
      border: none;
      cursor: pointer;
      margin-bottom: 10px;
      border-radius: 15px; /* 테두리 반경 조정 */
    }

    #login-btn {
      background-color: #000;
    }

    #signup-btn {
      background-color: #000;
    }

    #login-btn:hover, #signup-btn:hover {
    <!-- 호버할때 animation이 없어서 너무 생동감이없어요 --> background-color: #004080;
    }
  </style>
</head>
<body>

<header>


  <div id="popular-posts" class="left-container">
    <h2>Popular Posts</h2>
    <div style="width: 300px;">Lorem ipsum password application properties hello</div>
  </div>
  <h1 id="welcome-message">팝콘톡에 오신걸 환영합니다</h1>
  <div class="right-container">
    <div class="action-buttons">
      <input type="text" placeholder="Search">
      <button id="login-btn">Login</button>
      <button id="signup-btn">Signup</button>
    </div>
  </div>
</header>
<div class="center-container">
  <article id="posts" class="post-card">
    <button onclick=createPostData()>게시글 등록</button>
    <p id="post_name">
      <input type="text" id="post_nameInput" placeholder="게시글 제목을 작성해주세요">
    </p>
    <h3 id="post_content">
      <input type="text" id="post_contentInput" placeholder="게시글 내용을 입력해주세요">
    </h3>
    <img id="post_imgPreview" src="#" alt="Post Image" style="display: none;">
    <input type="file" id="post_imgInput" placeholder="게시글 이미지를 업로드해주세요"
           onchange="previewImage(event)">
  </article>
</div>
<div style="width: 200px; height: 50px;" id="logout-btn" onclick=logout()>로그아웃</div>
</body>

<script>
  function logout() {
    const jwt = sessionStorage.getItem('jwt'); // localStorage에서 'jwt' 토큰 가져오기
    console.log("jwt : {}", jwt);
    if (!jwt) {
      window.location.href = "/users/signup"; // 회원가입 페이지로 리다이렉트
    }
    var logoutBtn = document.querySelector("#logout-btn");
    if (jwt && logoutBtn) {
      logoutBtn.addEventListener('click', function () {
        sessionStorage.clear();
        window.location.href = "/users/testLogin";
      })
    }
  }

  function previewImage(event) {
    const input = event.target;
    // 파일이 선택되었는지 확인
    if (input.files && input.files[0]) {
      const reader = new FileReader();

      reader.onload = function () {
        // 이미지를 미리보기로 표시할 <img> 요소를 가져옴
        const imgPreview = document.getElementById('post_imgPreview');

        // FileReader에서 읽은 데이터 URL을 <img> 요소의 src 속성에 설정
        imgPreview.src = reader.result;

        // 미리보기 이미지를 표시하기 위해 <img> 요소를 보이도록 설정
        imgPreview.style.display = 'block';
      };

      // FileReader를 사용하여 파일의 내용을 읽음
      reader.readAsDataURL(input.files[0]);
    }
  }

  function createPostData() {
    const reader = new FileReader();
    let postImg = document.querySelector("#post_imgInput").files[0];
    reader.readAsDataURL(postImg);
    let postName = document.querySelector("#post_nameInput").value.trim(); // Remove leading/trailing whitespace
    let postContent = document.querySelector("#post_contentInput").value.trim(); // Remove leading/trailing whitespace

    let postImgPreview = document.getElementById('post_imgPreview');
    let postNameData = document.querySelector("#post_name");
    let postContentData = document.querySelector("#post_content");

    if (!postImg) {
      console.error("이미지를 선택하세요.");
      return; // Exit the function early
    }

    // Validate form inputs
    if (!postName || !postContent) {
      console.error("게시글 제목 또는 내용을 입력하세요.");
      return; // Exit the function early
    }

    reader.onload = function () {
      const base64Img = reader.result.split(',')[1]; // Extract base64 data
      console.log("base64Img", base64Img);
      const postData = {
        postImage: base64Img,
        postName: postName,
        postContent: postContent
      };

      const token = sessionStorage.getItem('jwt');

      fetch('/posts', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(postData), // Convert data to JSON format
      })
      .then(response => {
        console.log("response: {}", response);
        if (response.ok && token) {
          console.log("게시글 등록에 성공했습니다");
          postImgPreview.src = URL.createObjectURL(postImg);
          postNameData.textContent = postName;
          postContentData.textContent = postContent;
        } else {
          console.log("게시글 등록에 실패했습니다");
        }
      })

    }
  }

</script>
</html>
